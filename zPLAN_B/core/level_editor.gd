extends Node2D

# set this constant before game starts
const in_edit_mode: bool = false
var current_level_name = "TRANSition"


var fk_fall_time: float = 2.2
var fk_output_arr = [[], [], [], []]

var level_info = {
	"TRANSition" = {
		"fk_times": "[[5.17233543395996, 5.17233543395996, 5.17233543395996, 5.17233543395996, 7.88036327362061, 7.88036327362061, 7.88036327362061, 7.88036327362061, 9.50285701751709, 9.50285701751709, 9.50285701751709, 9.50285701751709, 11.3372333526611, 11.3372333526611, 11.3372333526611, 11.3372333526611, 13.6621311187744, 13.6621311187744, 13.6621311187744, 13.6621311187744, 14.6867111206055, 14.6867111206055, 14.6867111206055, 14.6867111206055, 15.6677558898926, 15.6677558898926, 15.6677558898926, 15.6677558898926, 16.3295238494873, 16.3295238494873, 16.3295238494873, 16.3295238494873, 17.5253513336182, 17.5253513336182, 17.5253513336182, 17.5253513336182, 19.4961460113525, 19.4961460113525, 19.4961460113525, 19.4961460113525, 21.8326538085938, 21.8326538085938, 21.8326538085938, 21.8326538085938, 23.6989562988281, 23.6989562988281, 23.6989562988281, 23.6989562988281, 25.5014064788818, 25.5014064788818, 25.5014064788818, 25.5014064788818, 26.665306854248, 26.665306854248, 26.665306854248, 26.665306854248, 27.1877544403076, 27.1877544403076, 27.1877544403076, 27.1877544403076, 28.0207717895508, 28.0207717895508, 28.0207717895508, 28.0207717895508, 32.4906127929687, 32.4906127929687, 32.4906127929687, 32.4906127929687, 34.8038986206055, 34.8038986206055, 34.8038986206055, 34.8038986206055, 35.7965515136719, 35.7965515136719, 35.7965515136719, 35.7965515136719, 37.1520164489746, 37.1520164489746, 37.1520164489746, 37.1520164489746, 38.4320190429687, 38.4320190429687, 38.4320190429687, 38.4320190429687, 39.6365516662598, 39.6365516662598, 39.6365516662598, 39.6365516662598, 40.4782760620117, 40.4782760620117, 40.4782760620117, 40.4782760620117, 41.6102493286133, 41.6102493286133, 41.6102493286133, 41.6102493286133, 42.803173828125, 42.803173828125, 42.803173828125, 42.803173828125, 43.8161437988281, 43.8161437988281, 43.8161437988281, 43.8161437988281, 44.6375511169434, 44.6375511169434, 44.6375511169434, 44.6375511169434, 45.363175201416, 45.363175201416, 45.363175201416, 45.363175201416, 46.184578704834, 46.184578704834, 46.184578704834, 46.184578704834, 47.656143951416, 47.656143951416, 47.656143951416, 47.656143951416, 48.0189559936523, 48.0189559936523, 48.0189559936523, 48.0189559936523, 49.1712463378906, 49.1712463378906, 49.1712463378906, 49.1712463378906, 49.8214042663574, 49.8214042663574, 49.8214042663574, 49.8214042663574, 53.1389587402344, 53.1389587402344, 53.1389587402344, 53.1389587402344, 55.1765068054199, 55.1765068054199, 55.1765068054199, 55.1765068054199, 57.7481163024902, 57.7481163024902, 57.7481163024902, 57.7481163024902, 59.3793190002441, 59.3793190002441, 59.3793190002441, 59.3793190002441, 61.7680709838867, 61.7680709838867, 61.7680709838867, 61.7680709838867, 64.0726516723633, 64.0726516723633, 64.0726516723633, 64.0726516723633, 65.7154663085937, 65.7154663085937, 65.7154663085937, 65.7154663085937, 67.1231735229492, 67.1231735229492, 67.1231735229492, 67.1231735229492, 69.683171081543, 69.683171081543, 69.683171081543, 69.683171081543], [3.87201814651489, 3.87201814651489, 3.87201814651489, 3.87201814651489, 6.54811744689941, 6.54811744689941, 6.54811744689941, 6.54811744689941, 8.33024959564209, 8.33024959564209, 8.33024959564209, 8.33024959564209, 9.20390014648438, 9.20390014648438, 9.20390014648438, 9.20390014648438, 9.85405902862549, 9.85405902862549, 9.85405902862549, 9.85405902862549, 10.3561904907227, 10.3561904907227, 10.3561904907227, 10.3561904907227, 10.9947393417358, 10.9947393417358, 10.9947393417358, 10.9947393417358, 11.6797283172607, 11.6797283172607, 11.6797283172607, 11.6797283172607, 12.0193193435669, 12.0193193435669, 12.0193193435669, 12.0193193435669, 12.3298862457275, 12.3298862457275, 12.3298862457275, 12.3298862457275, 13.342857170105, 13.342857170105, 13.342857170105, 13.342857170105, 14.152653503418, 14.152653503418, 14.152653503418, 14.152653503418, 15.0292060852051, 15.0292060852051, 15.0292060852051, 15.0292060852051, 15.3600910186768, 15.3600910186768, 15.3600910186768, 15.3600910186768, 16.0102489471436, 16.0102489471436, 16.0102489471436, 16.0102489471436, 16.8635833740234, 16.8635833740234, 16.8635833740234, 16.8635833740234, 17.1944664001465, 17.1944664001465, 17.1944664001465, 17.1944664001465, 17.833016204834, 17.833016204834, 17.833016204834, 17.833016204834, 18.2393653869629, 18.2393653869629, 18.2393653869629, 18.2393653869629, 18.8256690979004, 18.8256690979004, 18.8256690979004, 18.8256690979004, 19.1246250152588, 19.1246250152588, 19.1246250152588, 19.1246250152588, 20.0098865509033, 20.0098865509033, 20.0098865509033, 20.0098865509033, 20.3494785308838, 20.3494785308838, 20.3494785308838, 20.3494785308838, 21.5249889373779, 21.5249889373779, 21.5249889373779, 21.5249889373779, 22.1954639434814, 22.1954639434814, 22.1954639434814, 22.1954639434814, 22.8456237792969, 22.8456237792969, 22.8456237792969, 22.8456237792969, 24.2126987457275, 24.2126987457275, 24.2126987457275, 24.2126987457275, 24.8628566741943, 24.8628566741943, 24.8628566741943, 24.8628566741943, 26.2067115783691, 26.2067115783691, 26.2067115783691, 26.2067115783691, 26.9845798492432, 26.9845798492432, 26.9845798492432, 26.9845798492432, 27.5708835601807, 27.5708835601807, 27.5708835601807, 27.5708835601807, 28.3516548156738, 28.3516548156738, 28.3516548156738, 28.3516548156738, 28.5635383605957, 28.5635383605957, 28.5635383605957, 28.5635383605957, 29.0337417602539, 29.0337417602539, 29.0337417602539, 29.0337417602539, 29.4807250976563, 29.4807250976563, 29.4807250976563, 29.4807250976563, 31.167073059082, 31.167073059082, 31.167073059082, 31.167073059082, 33.1930168151855, 33.1930168151855, 33.1930168151855, 33.1930168151855, 33.8344657897949, 33.8344657897949, 33.8344657897949, 33.8344657897949, 35.1347854614258, 35.1347854614258, 35.1347854614258, 35.1347854614258, 36.4670303344727, 36.4670303344727, 36.4670303344727, 36.4670303344727, 37.7905662536621, 37.7905662536621, 37.7905662536621, 37.7905662536621, 39.1024940490723, 39.1024940490723, 39.1024940490723, 39.1024940490723, 40.1386840820312, 40.1386840820312, 40.1386840820312, 40.1386840820312, 41.1603630065918, 41.1603630065918, 41.1603630065918, 41.1603630065918, 42.1414077758789, 42.1414077758789, 42.1414077758789, 42.1414077758789, 42.4635818481445, 42.4635818481445, 42.4635818481445, 42.4635818481445, 43.5084808349609, 43.5084808349609, 43.5084808349609, 43.5084808349609, 44.1702507019043, 44.1702507019043, 44.1702507019043, 44.1702507019043, 45.0003631591797, 45.0003631591797, 45.0003631591797, 45.0003631591797, 45.6853530883789, 45.6853530883789, 45.6853530883789, 45.6853530883789, 46.483536529541, 46.483536529541, 46.483536529541, 46.483536529541, 47.3484809875488, 47.3484809875488, 47.3484809875488, 47.3484809875488, 48.0102508544922, 48.0102508544922, 48.0102508544922, 48.0102508544922, 48.8316543579102, 48.8316543579102, 48.8316543579102, 48.8316543579102, 49.4905212402344, 49.4905212402344, 49.4905212402344, 49.4905212402344, 51.1884811401367, 51.1884811401367, 51.1884811401367, 51.1884811401367, 54.5698860168457, 54.5698860168457, 54.5698860168457, 54.5698860168457, 57.4491622924805, 57.4491622924805, 57.4491622924805, 57.4491622924805, 58.7175491333008, 58.7175491333008, 58.7175491333008, 58.7175491333008, 60.4793632507324, 60.4793632507324, 60.4793632507324, 60.4793632507324, 63.1438568115234, 63.1438568115234, 63.1438568115234, 63.1438568115234, 64.4354675292969, 64.4354675292969, 64.4354675292969, 64.4354675292969, 66.3772323608398, 66.3772323608398, 66.3772323608398, 66.3772323608398, 72.4028137207031, 72.4028137207031, 72.4028137207031, 72.4028137207031], [3.1783221244812, 3.1783221244812, 3.1783221244812, 3.1783221244812, 5.86603145599365, 5.86603145599365, 5.86603145599365, 5.86603145599365, 8.20253925323486, 8.20253925323486, 8.20253925323486, 8.20253925323486, 8.84108810424805, 8.84108810424805, 8.84108810424805, 8.84108810424805, 9.6741044998169, 9.6741044998169, 9.6741044998169, 9.6741044998169, 10.2081630706787, 10.2081630706787, 10.2081630706787, 10.2081630706787, 10.8467119216919, 10.8467119216919, 10.8467119216919, 10.8467119216919, 11.1775959014893, 11.1775959014893, 11.1775959014893, 11.1775959014893, 11.5200908660889, 11.5200908660889, 11.5200908660889, 11.5200908660889, 12.1905668258667, 12.1905668258667, 12.1905668258667, 12.1905668258667, 13.1716096878052, 13.1716096878052, 13.1716096878052, 13.1716096878052, 13.5228116989136, 13.5228116989136, 13.5228116989136, 13.5228116989136, 14.152653503418, 14.152653503418, 14.152653503418, 14.152653503418, 14.8579586029053, 14.8579586029053, 14.8579586029053, 14.8579586029053, 15.1975505828857, 15.1975505828857, 15.1975505828857, 15.1975505828857, 15.8390014648438, 15.8390014648438, 15.8390014648438, 15.8390014648438, 16.1814964294434, 16.1814964294434, 16.1814964294434, 16.1814964294434, 16.7039459228516, 16.7039459228516, 16.7039459228516, 16.7039459228516, 17.3424938201904, 17.3424938201904, 17.3424938201904, 17.3424938201904, 18.706665802002, 18.706665802002, 18.706665802002, 18.706665802002, 19.4961460113525, 19.4961460113525, 19.4961460113525, 19.4961460113525, 20.2014511108398, 20.2014511108398, 20.2014511108398, 20.2014511108398, 21.3537414550781, 21.3537414550781, 21.3537414550781, 21.3537414550781, 21.6614063262939, 21.6614063262939, 21.6614063262939, 21.6614063262939, 22.0155094146729, 22.0155094146729, 22.0155094146729, 22.0155094146729, 22.7092063903809, 22.7092063903809, 22.7092063903809, 22.7092063903809, 23.1881187438965, 23.1881187438965, 23.1881187438965, 23.1881187438965, 23.7105663299561, 23.7105663299561, 23.7105663299561, 23.7105663299561, 24.0733783721924, 24.0733783721924, 24.0733783721924, 24.0733783721924, 24.2446258544922, 24.2446258544922, 24.2446258544922, 24.2446258544922, 24.3839462280273, 24.3839462280273, 24.3839462280273, 24.3839462280273, 24.8309295654297, 24.8309295654297, 24.8309295654297, 24.8309295654297, 25.3098419189453, 25.3098419189453, 25.3098419189453, 25.3098419189453, 25.8642185211182, 25.8642185211182, 25.8642185211182, 25.8642185211182, 26.1951015472412, 26.1951015472412, 26.1951015472412, 26.1951015472412, 26.8365524291992, 26.8365524291992, 26.8365524291992, 26.8365524291992, 27.4983222961426, 27.4983222961426, 27.4983222961426, 27.4983222961426, 28.1687973022461, 28.1687973022461, 28.1687973022461, 28.1687973022461, 28.874104309082, 28.874104309082, 28.874104309082, 28.874104309082, 29.3414066314697, 29.3414066314697, 29.3414066314697, 29.3414066314697, 29.6838996887207, 29.6838996887207, 29.6838996887207, 29.6838996887207, 30.1628120422363, 30.1628120422363, 30.1628120422363, 30.1628120422363, 30.804264831543, 30.804264831543, 30.804264831543, 30.804264831543, 31.4979598999023, 31.4979598999023, 31.4979598999023, 31.4979598999023, 32.1800468444824, 32.1800468444824, 32.1800468444824, 32.1800468444824, 32.8534248352051, 32.8534248352051, 32.8534248352051, 32.8534248352051, 33.8431747436523, 33.8431747436523, 33.8431747436523, 33.8431747436523, 34.484627532959, 34.484627532959, 34.484627532959, 34.484627532959, 35.4540603637695, 35.4540603637695, 35.4540603637695, 35.4540603637695, 36.1158264160156, 36.1158264160156, 36.1158264160156, 36.1158264160156, 37.4916084289551, 37.4916084289551, 37.4916084289551, 37.4916084289551, 38.1330612182617, 38.1330612182617, 38.1330612182617, 38.1330612182617, 38.7716110229492, 38.7716110229492, 38.7716110229492, 38.7716110229492, 39.4653060913086, 39.4653060913086, 39.4653060913086, 39.4653060913086, 40.3070304870605, 40.3070304870605, 40.3070304870605, 40.3070304870605, 40.8294799804687, 40.8294799804687, 40.8294799804687, 40.8294799804687, 41.4506118774414, 41.4506118774414, 41.4506118774414, 41.4506118774414, 41.9498413085937, 41.9498413085937, 41.9498413085937, 41.9498413085937, 42.6638534545898, 42.6638534545898, 42.6638534545898, 42.6638534545898, 43.3488433837891, 43.3488433837891, 43.3488433837891, 43.3488433837891, 43.6681182861328, 43.6681182861328, 43.6681182861328, 43.6681182861328, 44.3298881530762, 44.3298881530762, 44.3298881530762, 44.3298881530762, 45.1919258117676, 45.1919258117676, 45.1919258117676, 45.1919258117676, 46.0133331298828, 46.0133331298828, 46.0133331298828, 46.0133331298828, 46.6663940429687, 46.6663940429687, 46.6663940429687, 46.6663940429687, 46.8579605102539, 46.8579605102539, 46.8579605102539, 46.8579605102539, 47.0175979614258, 47.0175979614258, 47.0175979614258, 47.0175979614258, 47.5400436401367, 47.5400436401367, 47.5400436401367, 47.5400436401367, 48.5326965332031, 48.5326965332031, 48.5326965332031, 48.5326965332031, 48.991291809082, 48.991291809082, 48.991291809082, 48.991291809082, 49.6298416137695, 49.6298416137695, 49.6298416137695, 49.6298416137695, 50.1958282470703, 50.1958282470703, 50.1958282470703, 50.1958282470703, 50.6863487243652, 50.6863487243652, 50.6863487243652, 50.6863487243652, 51.0375526428223, 51.0375526428223, 51.0375526428223, 51.0375526428223, 52.5439460754395, 52.5439460754395, 52.5439460754395, 52.5439460754395, 53.844261932373, 53.844261932373, 53.844261932373, 53.844261932373, 57.1298873901367, 57.1298873901367, 57.1298873901367, 57.1298873901367, 58.0790031433105, 58.0790031433105, 58.0790031433105, 58.0790031433105, 59.071656036377, 59.071656036377, 59.071656036377, 59.071656036377, 61.1092079162598, 61.1092079162598, 61.1092079162598, 61.1092079162598, 62.4617660522461, 62.4617660522461, 62.4617660522461, 62.4617660522461, 63.8056228637695, 63.8056228637695, 63.8056228637695, 63.8056228637695, 65.1088455200195, 65.1088455200195, 65.1088455200195, 65.1088455200195, 66.0579574584961, 66.0579574584961, 66.0579574584961, 66.0579574584961, 68.4467132568359, 68.4467132568359, 68.4467132568359, 68.4467132568359], [4.55410413742065, 4.55410413742065, 4.55410413742065, 4.55410413742065, 7.20988636016846, 7.20988636016846, 7.20988636016846, 7.20988636016846, 8.51020412445068, 8.51020412445068, 8.51020412445068, 8.51020412445068, 9.34321956634522, 9.34321956634522, 9.34321956634522, 9.34321956634522, 10.5361450195313, 10.5361450195313, 10.5361450195313, 10.5361450195313, 11.8480728149414, 11.8480728149414, 11.8480728149414, 11.8480728149414, 12.5417688369751, 12.5417688369751, 12.5417688369751, 12.5417688369751, 12.8407257080078, 12.8407257080078, 12.8407257080078, 12.8407257080078, 13.8449886322021, 13.8449886322021, 13.8449886322021, 13.8449886322021, 14.5067565917969, 14.5067565917969, 14.5067565917969, 14.5067565917969, 15.5400455474854, 15.5400455474854, 15.5400455474854, 15.5400455474854, 16.5094783782959, 16.5094783782959, 16.5094783782959, 16.5094783782959, 17.0116107940674, 17.0116107940674, 17.0116107940674, 17.0116107940674, 17.6733787536621, 17.6733787536621, 17.6733787536621, 17.6733787536621, 18.0042636871338, 18.0042636871338, 18.0042636871338, 18.0042636871338, 18.5267112731934, 18.5267112731934, 18.5267112731934, 18.5267112731934, 18.9533794403076, 18.9533794403076, 18.9533794403076, 18.9533794403076, 19.8270290374756, 19.8270290374756, 19.8270290374756, 19.8270290374756, 20.7877548217773, 20.7877548217773, 20.7877548217773, 20.7877548217773, 22.3667114257813, 22.3667114257813, 22.3667114257813, 22.3667114257813, 22.99655418396, 22.99655418396, 22.99655418396, 22.99655418396, 24.5116546630859, 24.5116546630859, 24.5116546630859, 24.5116546630859, 25.1385944366455, 25.1385944366455, 25.1385944366455, 25.1385944366455, 25.6639450073242, 25.6639450073242, 25.6639450073242, 25.6639450073242, 26.5172794342041, 26.5172794342041, 26.5172794342041, 26.5172794342041, 27.144217300415, 27.144217300415, 27.144217300415, 27.144217300415, 27.7421310424805, 27.7421310424805, 27.7421310424805, 27.7421310424805, 28.4996822357178, 28.4996822357178, 28.4996822357178, 28.4996822357178, 29.022131729126, 29.022131729126, 29.022131729126, 29.022131729126, 29.5242622375488, 29.5242622375488, 29.5242622375488, 29.5242622375488, 29.8435371398926, 29.8435371398926, 29.8435371398926, 29.8435371398926, 30.4849899291992, 30.4849899291992, 30.4849899291992, 30.4849899291992, 31.8375518798828, 31.8375518798828, 31.8375518798828, 31.8375518798828, 33.5238998413086, 33.5238998413086, 33.5238998413086, 33.5238998413086, 34.1537406921387, 34.1537406921387, 34.1537406921387, 34.1537406921387, 35.1231735229492, 35.1231735229492, 35.1231735229492, 35.1231735229492, 36.829842376709, 36.829842376709, 36.829842376709, 36.829842376709, 37.8021781921387, 37.8021781921387, 37.8021781921387, 37.8021781921387, 39.1024940490723, 39.1024940490723, 39.1024940490723, 39.1024940490723, 39.9442184448242, 39.9442184448242, 39.9442184448242, 39.9442184448242, 40.5218132019043, 40.5218132019043, 40.5218132019043, 40.5218132019043, 42.2923362731934, 42.2923362731934, 42.2923362731934, 42.2923362731934, 42.9744232177734, 42.9744232177734, 42.9744232177734, 42.9744232177734, 43.9990013122559, 43.9990013122559, 43.9990013122559, 43.9990013122559, 44.8407257080078, 44.8407257080078, 44.8407257080078, 44.8407257080078, 45.5228126525879, 45.5228126525879, 45.5228126525879, 45.5228126525879, 46.3238990783691, 46.3238990783691, 46.3238990783691, 46.3238990783691, 47.818684387207, 47.818684387207, 47.818684387207, 47.818684387207, 48.1785934448242, 48.1785934448242, 48.1785934448242, 48.1785934448242, 49.3221786499023, 49.3221786499023, 49.3221786499023, 49.3221786499023, 49.833016204834, 49.833016204834, 49.833016204834, 49.833016204834, 50.3554656982422, 50.3554656982422, 50.3554656982422, 50.3554656982422, 50.869206237793, 50.869206237793, 50.869206237793, 50.869206237793, 52.5207260131836, 52.5207260131836, 52.5207260131836, 52.5207260131836, 56.4797294616699, 56.4797294616699, 56.4797294616699, 56.4797294616699, 59.6028106689453, 59.6028106689453, 59.6028106689453, 59.6028106689453, 61.8232162475586, 61.8232162475586, 61.8232162475586, 61.8232162475586, 64.4557846069336, 64.4557846069336, 64.4557846069336, 64.4557846069336, 67.1231735229492, 67.1231735229492, 67.1231735229492, 67.1231735229492, 69.683171081543, 69.683171081543, 69.683171081543, 69.683171081543]]", 
			"music": preload("res://zPLAN_B/MUSIC/gamejamtest2 (1).mp3")#preload("res://zPLAN_B/MUSIC/gamejamtest2 (1).mp3")
	}
}

func _ready():
	
	$MusicPlayer.stream = level_info.get(current_level_name).get("music")
	$MusicPlayer.play()
	

	if in_edit_mode:
		Signals.KeyListenerPress.connect(KeyListenerPress)
	else:
		var fk_times = level_info.get(current_level_name).get("fk_times")
		var fk_times_arr = str_to_var(fk_times)
		#print(fk_times_arr[0])
		
		var counter: int = 0
		for key in fk_times_arr:
			
			var button_name: String = ""
			match counter:
				0:
					button_name = "button_A"
				1: 
					button_name = "button_S"
				2:
					button_name = "button_K"
				3:
					button_name = "button_L"
			
			for delay in key:
				SpawnFallingKey(button_name, delay)
			
			counter += 1
	
func KeyListenerPress(button_name: String, array_num: int):
	print(str(array_num) + " " + str($MusicPlayer.get_playback_position()))
	fk_output_arr[array_num].append($MusicPlayer.get_playback_position() - fk_fall_time)
	
func SpawnFallingKey(button_name: String, delay: float):
	await get_tree().create_timer(delay).timeout
	Signals.CreateFallingKey.emit(button_name)



func _on_music_player_finished():
	print(fk_output_arr)
